function [Cond]=new_cond(z,Y,n,dof_max,fun,size,tf,ts)

Ys2=Y;


for j = 1:dof_max
for t=1:n
a = sprintf('z(%d)',(j-1)*n+t);
b = sprintf('array(%d,%d)',[j, t+1]);
eval(strcat(b,'=',a));

a2 = sprintf('z(%d)',dof_max*n+(j-1)*n+t);
b2 = sprintf('array_v(%d,%d)',[j,t+1]);
eval(strcat(b2,'=',a2));

end
end

% array(1:dof_max,:)=[zeros(dof_max,1),array(1:dof_max,:)];
% array_v(1:dof_max,:)=[zeros(dof_max,1),array_v(1:dof_max,:)];

array(:,end+1) = [0,0,0]';
array_v(:,end+1) =  [0,0,0]';

for dof=1:dof_max
[Q_data(dof,:),Qd_data(dof,:),Qdd_data(dof,:),T]=Trajectory_f(array(dof,:),array_v(dof,:),tf,ts);
end



W = zeros(length(Q_data(1,:))*dof_max,size);

for i=1:length(Q_data(1,:))
   
q1=Q_data(1,i);
q2=Q_data(2,i);
q3=Q_data(3,i);

qd1=Qd_data(1,i);
qd2=Qd_data(2,i);
qd3=Qd_data(3,i);

qdd1=Qdd_data(1,i);
qdd2=Qdd_data(2,i);
qdd3=Qdd_data(3,i);

%
% 3dof_inplanepitch_svd    
%  W(1+(i-1)*dof_max,:) = [ (q3^2*qdd1)/2 - (49*q3*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 - (49*q3*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + (q3^2*qdd1*cos(2*q2 - 5239260779425957/9007199254740992))/2 + 2*q3*qd1*qd3 - 2*q3^2*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992) + 2*q3*qd1*qd3*cos(2*q2 - 5239260779425957/9007199254740992), q3*qdd1 - (49*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 - (49*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + 2*qd1*qd3 + q3*qdd1*cos(2*q2 - 5239260779425957/9007199254740992) + 2*qd1*qd3*cos(2*q2 - 5239260779425957/9007199254740992) - 4*q3*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992), (49*cos(q1 + q2 - 5239260779425957/18014398509481984))/5 - (49*cos(q1 - q2 + 5239260779425957/18014398509481984))/5 + 2*q3*qdd1*sin(2*q2 - 5239260779425957/9007199254740992) + 4*qd1*qd3*sin(2*q2 - 5239260779425957/9007199254740992) + 8*q3*qd1*qd2*cos(2*q2 - 5239260779425957/9007199254740992),   0, -q1,    0,    0, -qd1,          0,          0, -sign(qd1), 2*cos(q2 - 5239260779425957/18014398509481984)*qd2^2 + qdd2*sin(q2 - 5239260779425957/18014398509481984), qdd1*sin(2*q2) + 4*qd1*qd2*cos(2*q2), (10735061*qdd1)/200000000 + (2107*cos(q1 - q2))/10000 - (141169*sin(q1 - q2))/100000 - (147*sin(q1 + q2 - 5239260779425957/18014398509481984))/200 - (147*sin(q1 - q2 + 5239260779425957/18014398509481984))/200 - (2107*cos(q1 + q2))/10000 - (141169*sin(q1 + q2))/100000 + (8115261*qdd1*cos(2*q2))/200000000 - (123883*qdd1*sin(2*q2))/10000000 + (8643*qdd1*cos(5239260779425957/18014398509481984))/200000 - (129*qdd1*sin(5239260779425957/18014398509481984))/20000 + (9*qdd1*cos(2*q2 - 5239260779425957/9007199254740992))/800 + (8643*qdd1*cos(2*q2 - 5239260779425957/18014398509481984))/200000 - (129*qdd1*sin(2*q2 - 5239260779425957/18014398509481984))/20000 - (129*qd1*qd2*cos(2*q2 - 5239260779425957/18014398509481984))/5000 - (9*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992))/200 - (8643*qd1*qd2*sin(2*q2 - 5239260779425957/18014398509481984))/50000 - (123883*qd1*qd2*cos(2*q2))/2500000 - (8115261*qd1*qd2*sin(2*q2))/50000000, -qdd2,    0, qdd1/2 - (qdd1*cos(2*q2 - 5239260779425957/9007199254740992))/2 + 2*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992), (49*cos(q1 - q2))/10 - (49*cos(q1 + q2))/10 - (3*qdd1*sin(5239260779425957/18014398509481984))/20 - (3*qdd1*sin(2*q2 - 5239260779425957/18014398509481984))/20 - (3*qd1*qd2*cos(2*q2 - 5239260779425957/18014398509481984))/5, 2*sin(q2 - 5239260779425957/18014398509481984)*qd2^2 - qdd2*cos(q2 - 5239260779425957/18014398509481984), qdd1*sin(2*q2 - 5239260779425957/9007199254740992) + 4*qd1*qd2*cos(2*q2 - 5239260779425957/9007199254740992), (3*qdd1*cos(q2 - 5239260779425957/9007199254740992))/20 - (49*sin(q1 + 5239260779425957/18014398509481984))/10 - (49*sin(q1 - 5239260779425957/18014398509481984))/10 + (3*qdd1*cos(q2))/20 - (3*qd1*qd2*sin(q2))/10 - (3*qd1*qd2*sin(q2 - 5239260779425957/9007199254740992))/10];
%  W(2+(i-1)*dof_max,:) =                                        [                                                                                                                                    (49*q3*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 + q3^2*qdd2 - (49*q3*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + q3^2*qd1^2*sin(2*q2 - 5239260779425957/9007199254740992) + 4*q3*qd2*qd3,                                                                                                                   2*q3*sin(2*q2 - 5239260779425957/9007199254740992)*qd1^2 - (49*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + (49*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 + 2*q3*qdd2 + 4*qd2*qd3,                                                                                                            - 4*q3*cos(2*q2 - 5239260779425957/9007199254740992)*qd1^2 + 2*qdd3 + (49*cos(q1 + q2 - 5239260779425957/18014398509481984))/5 + (49*cos(q1 - q2 + 5239260779425957/18014398509481984))/5, -q2,   0,    0, -qd2,    0,          0, -sign(qd2),          0,                                                        qdd1*sin(q2 - 5239260779425957/18014398509481984),                   -2*qd1^2*cos(2*q2),                                                                                                                                                                                                                                                                                   (10735061*qdd2)/100000000 - (2107*cos(q1 - q2))/10000 + (141169*sin(q1 - q2))/100000 - (147*sin(q1 + q2 - 5239260779425957/18014398509481984))/200 + (147*sin(q1 - q2 + 5239260779425957/18014398509481984))/200 - (2107*cos(q1 + q2))/10000 - (141169*sin(q1 + q2))/100000 + (129*qd1^2*cos(2*q2 - 5239260779425957/18014398509481984))/10000 + (9*qd1^2*sin(2*q2 - 5239260779425957/9007199254740992))/400 + (8643*qd1^2*sin(2*q2 - 5239260779425957/18014398509481984))/100000 + (123883*qd1^2*cos(2*q2))/5000000 + (8115261*qd1^2*sin(2*q2))/100000000 + (8643*qdd2*cos(5239260779425957/18014398509481984))/100000 - (129*qdd2*sin(5239260779425957/18014398509481984))/10000, -qdd1, qdd2,                                                                      -qd1^2*sin(2*q2 - 5239260779425957/9007199254740992),                                                               (3*cos(2*q2 - 5239260779425957/18014398509481984)*qd1^2)/10 - (49*cos(q1 - q2))/10 - (49*cos(q1 + q2))/10 - (3*qdd2*sin(5239260779425957/18014398509481984))/10,                                                       -qdd1*cos(q2 - 5239260779425957/18014398509481984),                                                       -2*qd1^2*cos(2*q2 - 5239260779425957/9007199254740992),                                                                                                                                                                                                   (3*qd1^2*sin(q2))/20 + (3*qd1^2*sin(q2 - 5239260779425957/9007199254740992))/20];
%  W(3+(i-1)*dof_max,:) =                                        [                                                                                                                                                                                                  qdd3 - q3*qd1^2 - 2*q3*qd2^2 + (49*cos(q2 - 5239260779425957/18014398509481984)*cos(q1))/5 - q3*qd1^2*cos(2*q2 - 5239260779425957/9007199254740992),                                                                                                                                                                                                                                                    - qd1^2*cos(2*q2 - 5239260779425957/9007199254740992) - qd1^2 - 2*qd2^2,                                                                                                                                                                                                                                     - 2*sin(2*q2 - 5239260779425957/9007199254740992)*qd1^2 + 2*qdd2,   0,   0, -qd3,    0,    0, -sign(qd3),          0,          0,                                                                                                        0,                                    0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    0,     0,    0,                                                                                                                         0,                                                                                                                                                                                                                             0,                                                                                                        0,                                                                                                            0,                                                                                                                                                                                                                                                                                 0];
%   

%new_3dof_inaxis_svd_Y

%  
W(1+(i-1)*dof_max,:) = [ (4075861*qdd1)/200000000 + (2107*cos(q1 - q2))/10000 + (62769*sin(q1 - q2))/100000 - (147*sin(q1 + q2 - 5239260779425957/18014398509481984))/200 - (147*sin(q1 - q2 + 5239260779425957/18014398509481984))/200 - (2107*cos(q1 + q2))/10000 + (62769*sin(q1 + q2))/100000 + (1456061*qdd1*cos(2*q2))/200000000 + (55083*qdd1*sin(2*q2))/10000000 + (1281*q3*qdd1)/10000 + (1281*qd1*qd3)/5000 + (49*q3*sin(q1 + q2))/10 + (q3^2*qdd1)/2 - (3843*qdd1*cos(5239260779425957/18014398509481984))/200000 - (129*qdd1*sin(5239260779425957/18014398509481984))/20000 + (9*qdd1*cos(2*q2 - 5239260779425957/9007199254740992))/800 - (3843*qdd1*cos(2*q2 - 5239260779425957/18014398509481984))/200000 + (49*q3*sin(q1 - q2))/10 - (129*qdd1*sin(2*q2 - 5239260779425957/18014398509481984))/20000 - (3*q3*qdd1*cos(5239260779425957/18014398509481984))/20 - (3*qd1*qd3*cos(5239260779425957/18014398509481984))/10 - (3*q3*qdd1*cos(2*q2 - 5239260779425957/18014398509481984))/20 - (129*qd1*qd2*cos(2*q2 - 5239260779425957/18014398509481984))/5000 - (3*qd1*qd3*cos(2*q2 - 5239260779425957/18014398509481984))/10 - (9*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992))/200 + (3843*qd1*qd2*sin(2*q2 - 5239260779425957/18014398509481984))/50000 + (1281*q3*qdd1*cos(2*q2))/10000 + (55083*qd1*qd2*cos(2*q2))/2500000 + (1281*qd1*qd3*cos(2*q2))/5000 + (43*q3*qdd1*sin(2*q2))/1000 - (1456061*qd1*qd2*sin(2*q2))/50000000 + (43*qd1*qd3*sin(2*q2))/500 + 2*q3*qd1*qd3 + (q3^2*qdd1*cos(2*q2))/2 - 2*q3^2*qd1*qd2*sin(2*q2) + (3*q3*qd1*qd2*sin(2*q2 - 5239260779425957/18014398509481984))/5 + (43*q3*qd1*qd2*cos(2*q2))/250 + 2*q3*qd1*qd3*cos(2*q2) - (1281*q3*qd1*qd2*sin(2*q2))/2500, (q3^2*qdd1)/2 - (49*q3*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 - (49*q3*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + (q3^2*qdd1*cos(2*q2 - 5239260779425957/9007199254740992))/2 + 2*q3*qd1*qd3 - 2*q3^2*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992) + 2*q3*qd1*qd3*cos(2*q2 - 5239260779425957/9007199254740992), (1281*qdd1)/10000 + (49*sin(q1 - q2))/10 + (49*sin(q1 + q2))/10 + (1281*qdd1*cos(2*q2))/10000 + (43*qdd1*sin(2*q2))/1000 + q3*qdd1 + 2*qd1*qd3 - (3*qdd1*cos(5239260779425957/18014398509481984))/20 - (3*qdd1*cos(2*q2 - 5239260779425957/18014398509481984))/20 + (3*qd1*qd2*sin(2*q2 - 5239260779425957/18014398509481984))/5 + q3*qdd1*cos(2*q2) + (43*qd1*qd2*cos(2*q2))/250 + 2*qd1*qd3*cos(2*q2) - (1281*qd1*qd2*sin(2*q2))/2500 - 4*q3*qd1*qd2*sin(2*q2), -(49*sin(q1))/5, q3*qdd1 - (49*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 - (49*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + 2*qd1*qd3 + q3*qdd1*cos(2*q2 - 5239260779425957/9007199254740992) + 2*qd1*qd3*cos(2*q2 - 5239260779425957/9007199254740992) - 4*q3*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992),   0, -q1,    0,    0, -qd1,          0,          0, -sign(qd1),    0, 2*sin(q2 - 5239260779425957/18014398509481984)*qd2^2 - qdd2*cos(q2 - 5239260779425957/18014398509481984), qdd1/2 - (qdd1*cos(2*q2 - 5239260779425957/9007199254740992))/2 + 2*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992), qdd1/2 - (qdd1*cos(2*q2))/2 + 2*qd1*qd2*sin(2*q2), (3*qdd1)/20 - (49*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 - (49*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 + (3*qdd1*cos(2*q2 - 5239260779425957/9007199254740992))/20 - (3*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992))/5, qdd1, -qdd2, (2881*qdd1)/10000 - (49*sin(q1 - q2))/10 - (49*sin(q1 + q2))/10 + (2881*qdd1*cos(2*q2))/10000 + (3*qdd1*cos(5239260779425957/18014398509481984))/20 + (3*qdd1*cos(2*q2 - 5239260779425957/18014398509481984))/20 - (3*qd1*qd2*sin(2*q2 - 5239260779425957/18014398509481984))/5 - (2881*qd1*qd2*sin(2*q2))/2500, 2*cos(q2)*qd2^2 + qdd2*sin(q2)];
W(2+(i-1)*dof_max,:) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (4075861*qdd2)/100000000 + (43*qdd3)/1000 - (2107*cos(q1 - q2))/10000 - (62769*sin(q1 - q2))/100000 - (147*sin(q1 + q2 - 5239260779425957/18014398509481984))/200 + (147*sin(q1 - q2 + 5239260779425957/18014398509481984))/200 - (2107*cos(q1 + q2))/10000 + (62769*sin(q1 + q2))/100000 + (129*qd1^2*cos(2*q2 - 5239260779425957/18014398509481984))/10000 + (1281*q3*qdd2)/5000 + (1281*qd2*qd3)/2500 + (9*qd1^2*sin(2*q2 - 5239260779425957/9007199254740992))/400 - (3843*qd1^2*sin(2*q2 - 5239260779425957/18014398509481984))/100000 - (55083*qd1^2*cos(2*q2))/5000000 + (1456061*qd1^2*sin(2*q2))/100000000 + (49*q3*sin(q1 + q2))/10 + q3^2*qdd2 - (3843*qdd2*cos(5239260779425957/18014398509481984))/100000 - (129*qdd2*sin(5239260779425957/18014398509481984))/10000 - (3*qdd3*sin(5239260779425957/18014398509481984))/20 - (49*q3*sin(q1 - q2))/10 - (3*q3*qdd2*cos(5239260779425957/18014398509481984))/10 - (3*qd2*qd3*cos(5239260779425957/18014398509481984))/5 + q3^2*qd1^2*sin(2*q2) + 4*q3*qd2*qd3 - (3*q3*qd1^2*sin(2*q2 - 5239260779425957/18014398509481984))/10 - (43*q3*qd1^2*cos(2*q2))/500 + (1281*q3*qd1^2*sin(2*q2))/5000,                                                                                                                                    (49*q3*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 + q3^2*qdd2 - (49*q3*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + q3^2*qd1^2*sin(2*q2 - 5239260779425957/9007199254740992) + 4*q3*qd2*qd3,                                                                                                                                                                       (1281*qdd2)/5000 - (49*sin(q1 - q2))/10 + (49*sin(q1 + q2))/10 + 2*q3*qdd2 + 4*qd2*qd3 - (3*qd1^2*sin(2*q2 - 5239260779425957/18014398509481984))/10 - (43*qd1^2*cos(2*q2))/500 + (1281*qd1^2*sin(2*q2))/5000 - (3*qdd2*cos(5239260779425957/18014398509481984))/10 + 2*q3*qd1^2*sin(2*q2),               0,                                                                                                                   2*q3*sin(2*q2 - 5239260779425957/9007199254740992)*qd1^2 - (49*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + (49*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 + 2*q3*qdd2 + 4*qd2*qd3, -q2,   0,    0, -qd2,    0,          0, -sign(qd2),          0, qdd2,                                                       -qdd1*cos(q2 - 5239260779425957/18014398509481984),                                                                      -qd1^2*sin(2*q2 - 5239260779425957/9007199254740992),                                  -qd1^2*sin(2*q2),                                                              (3*sin(2*q2 - 5239260779425957/9007199254740992)*qd1^2)/10 + (3*qdd2)/10 - (49*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + (49*sin(q1 - q2 + 5239260779425957/18014398509481984))/10,    0, -qdd1,                                                                                                (2881*qdd2)/5000 + (49*sin(q1 - q2))/10 - (49*sin(q1 + q2))/10 + (3*qd1^2*sin(2*q2 - 5239260779425957/18014398509481984))/10 + (2881*qd1^2*sin(2*q2))/5000 + (3*qdd2*cos(5239260779425957/18014398509481984))/10,                   qdd1*sin(q2)];
W(3+(i-1)*dof_max,:) = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           (43*qdd2)/1000 + qdd3 - (49*cos(q1 - q2))/10 - (49*cos(q1 + q2))/10 + (3*qd1^2*cos(5239260779425957/18014398509481984))/20 + (3*qd2^2*cos(5239260779425957/18014398509481984))/10 + (3*qd1^2*cos(2*q2 - 5239260779425957/18014398509481984))/20 - (1281*qd1^2*cos(2*q2))/10000 - (43*qd1^2*sin(2*q2))/1000 - q3*qd1^2 - 2*q3*qd2^2 - (3*qdd2*sin(5239260779425957/18014398509481984))/20 - (1281*qd1^2)/10000 - (1281*qd2^2)/5000 - q3*qd1^2*cos(2*q2),                                                                                                                                        qdd3 + (49*cos(q1 + q2 - 5239260779425957/18014398509481984))/10 + (49*cos(q1 - q2 + 5239260779425957/18014398509481984))/10 - q3*qd1^2 - 2*q3*qd2^2 - q3*qd1^2*cos(2*q2 - 5239260779425957/9007199254740992),                                                                                                                                                                                                                                                                                                                                                                                                                              - qd1^2*cos(2*q2) - qd1^2 - 2*qd2^2,               0,                                                                                                                                                                                                                                                    - qd1^2*cos(2*q2 - 5239260779425957/9007199254740992) - qd1^2 - 2*qd2^2,   0,   0, -qd3,    0,    0, -sign(qd3),          0,          0,    0,                                                                                                        0,                                                                                                                         0,                                                 0,                                                                                                                                                                                                                                                             0,    0,     0,                                                                                                                                                                                                                                                                                                               0,                              0];
 
%W(1+(i-1)*dof_max:dof_max+(i-1)*dof_max,:)=double(fun(Q_data(1,i),Q_data(2,i),Q_data(3,i),Qd_data(1,i),Qd_data(2,i),Qd_data(3,i),Qdd_data(1,i),Qdd_data(2,i),Qdd_data(3,i)));

% A0=[];
% W(1+(i-1)*dof_max:dof_max+(i-1)*dof_max,:)=subs(Ys2, [q(1:dof_max) qd(1:dof_max) qdd(1:dof_max)],[transpose(Q(1:dof_max,i)), transpose(Qd(1:dof_max,i)), transpose(Qdd(1:dof_max,i))]);
end


Cond = double(cond(W));


end