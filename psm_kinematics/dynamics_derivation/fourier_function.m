function [val]=fourier_function(z,four)

%tic

n = 2*four.N+1;

for j = 1:four.dof
for t=1:n
temp1 = sprintf('z(%d)',(j-1)*n+t);
temp2 = sprintf('v(%d,%d)',[j, t]);
eval(strcat(temp2,'=',temp1,';'));


end
end
%toc
% disc_num = four.tf/four.ts;
% time = linspace(0,four.tf-four.ts,disc_num);



F=zeros(four.dof*four.disc_num,four.size);

for k = 1:four.disc_num 
qi   =  zeros(four.dof,1);
qdi  =  zeros(four.dof,1);
qddi =  zeros(four.dof,1);

for j = 1:four.dof
qi(j) = v(j,n);

for i =1:four.N
    t = four.time(k);
    qi(j) = qi(j)+v(j,i)/(four.w*i)*sin(four.w*i*t)-v(j,four.N+i)/(four.w*i)*cos(four.w*i*t);
    qdi(j) = qdi(j)+v(j,i)*cos(four.w*i*t)+v(j,four.N+i)*sin(four.w*i*t);
    qddi(j) = qddi(j)-v(j,i)*(four.w*i)*sin(four.w*i*t)+v(j,four.N+i)*(four.w*i)*cos(four.w*i*t);    
end
end

%F((k-1)*four.dof+1:(k-1)*four.dof+four.dof,:) = four.fun(qi(1),qi(2),qi(3),qdi(1),qdi(2),qdi(3),qddi(1),qddi(2),qddi(3)).*(1./four.scale_noise.');


q1 = qi(1);
q2 = qi(2);
q3 = qi(3);

qd1 = qdi(1);
qd2 = qdi(2);
qd3 = qdi(3);

qdd1 = qddi(1);
qdd2 = qddi(2);
qdd3 = qddi(3);

F((k-1)*four.dof+1,:)=[ (4075861*qdd1)/200000000 + (2107*cos(q1 - q2))/10000 + (62769*sin(q1 - q2))/100000 - (147*sin(q1 + q2 - 5239260779425957/18014398509481984))/200 - (147*sin(q1 - q2 + 5239260779425957/18014398509481984))/200 - (2107*cos(q1 + q2))/10000 + (62769*sin(q1 + q2))/100000 + (1456061*qdd1*cos(2*q2))/200000000 + (55083*qdd1*sin(2*q2))/10000000 + (1281*q3*qdd1)/10000 + (1281*qd1*qd3)/5000 + (49*q3*sin(q1 + q2))/10 + (q3^2*qdd1)/2 - (3843*qdd1*cos(5239260779425957/18014398509481984))/200000 - (129*qdd1*sin(5239260779425957/18014398509481984))/20000 + (9*qdd1*cos(2*q2 - 5239260779425957/9007199254740992))/800 - (3843*qdd1*cos(2*q2 - 5239260779425957/18014398509481984))/200000 + (49*q3*sin(q1 - q2))/10 - (129*qdd1*sin(2*q2 - 5239260779425957/18014398509481984))/20000 - (3*q3*qdd1*cos(5239260779425957/18014398509481984))/20 - (3*qd1*qd3*cos(5239260779425957/18014398509481984))/10 - (3*q3*qdd1*cos(2*q2 - 5239260779425957/18014398509481984))/20 - (129*qd1*qd2*cos(2*q2 - 5239260779425957/18014398509481984))/5000 - (3*qd1*qd3*cos(2*q2 - 5239260779425957/18014398509481984))/10 - (9*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992))/200 + (3843*qd1*qd2*sin(2*q2 - 5239260779425957/18014398509481984))/50000 + (1281*q3*qdd1*cos(2*q2))/10000 + (55083*qd1*qd2*cos(2*q2))/2500000 + (1281*qd1*qd3*cos(2*q2))/5000 + (43*q3*qdd1*sin(2*q2))/1000 - (1456061*qd1*qd2*sin(2*q2))/50000000 + (43*qd1*qd3*sin(2*q2))/500 + 2*q3*qd1*qd3 + (q3^2*qdd1*cos(2*q2))/2 - 2*q3^2*qd1*qd2*sin(2*q2) + (3*q3*qd1*qd2*sin(2*q2 - 5239260779425957/18014398509481984))/5 + (43*q3*qd1*qd2*cos(2*q2))/250 + 2*q3*qd1*qd3*cos(2*q2) - (1281*q3*qd1*qd2*sin(2*q2))/2500, (q3^2*qdd1)/2 - (49*q3*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 - (49*q3*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + (q3^2*qdd1*cos(2*q2 - 5239260779425957/9007199254740992))/2 + 2*q3*qd1*qd3 - 2*q3^2*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992) + 2*q3*qd1*qd3*cos(2*q2 - 5239260779425957/9007199254740992), (1281*qdd1)/10000 + (49*sin(q1 - q2))/10 + (49*sin(q1 + q2))/10 + (1281*qdd1*cos(2*q2))/10000 + (43*qdd1*sin(2*q2))/1000 + q3*qdd1 + 2*qd1*qd3 - (3*qdd1*cos(5239260779425957/18014398509481984))/20 - (3*qdd1*cos(2*q2 - 5239260779425957/18014398509481984))/20 + (3*qd1*qd2*sin(2*q2 - 5239260779425957/18014398509481984))/5 + q3*qdd1*cos(2*q2) + (43*qd1*qd2*cos(2*q2))/250 + 2*qd1*qd3*cos(2*q2) - (1281*qd1*qd2*sin(2*q2))/2500 - 4*q3*qd1*qd2*sin(2*q2), -(49*sin(q1))/5, q3*qdd1 - (49*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 - (49*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + 2*qd1*qd3 + q3*qdd1*cos(2*q2 - 5239260779425957/9007199254740992) + 2*qd1*qd3*cos(2*q2 - 5239260779425957/9007199254740992) - 4*q3*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992),   0, -q1,    0,    0, -qd1,          0,          0, -sign(qd1),    0, 2*sin(q2 - 5239260779425957/18014398509481984)*qd2^2 - qdd2*cos(q2 - 5239260779425957/18014398509481984), qdd1/2 - (qdd1*cos(2*q2 - 5239260779425957/9007199254740992))/2 + 2*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992), qdd1/2 - (qdd1*cos(2*q2))/2 + 2*qd1*qd2*sin(2*q2), (3*qdd1)/20 - (49*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 - (49*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 + (3*qdd1*cos(2*q2 - 5239260779425957/9007199254740992))/20 - (3*qd1*qd2*sin(2*q2 - 5239260779425957/9007199254740992))/5, qdd1, -qdd2, (2881*qdd1)/10000 - (49*sin(q1 - q2))/10 - (49*sin(q1 + q2))/10 + (2881*qdd1*cos(2*q2))/10000 + (3*qdd1*cos(5239260779425957/18014398509481984))/20 + (3*qdd1*cos(2*q2 - 5239260779425957/18014398509481984))/20 - (3*qd1*qd2*sin(2*q2 - 5239260779425957/18014398509481984))/5 - (2881*qd1*qd2*sin(2*q2))/2500, 2*cos(q2)*qd2^2 + qdd2*sin(q2)];
F((k-1)*four.dof+2,:)=[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (4075861*qdd2)/100000000 + (43*qdd3)/1000 - (2107*cos(q1 - q2))/10000 - (62769*sin(q1 - q2))/100000 - (147*sin(q1 + q2 - 5239260779425957/18014398509481984))/200 + (147*sin(q1 - q2 + 5239260779425957/18014398509481984))/200 - (2107*cos(q1 + q2))/10000 + (62769*sin(q1 + q2))/100000 + (129*qd1^2*cos(2*q2 - 5239260779425957/18014398509481984))/10000 + (1281*q3*qdd2)/5000 + (1281*qd2*qd3)/2500 + (9*qd1^2*sin(2*q2 - 5239260779425957/9007199254740992))/400 - (3843*qd1^2*sin(2*q2 - 5239260779425957/18014398509481984))/100000 - (55083*qd1^2*cos(2*q2))/5000000 + (1456061*qd1^2*sin(2*q2))/100000000 + (49*q3*sin(q1 + q2))/10 + q3^2*qdd2 - (3843*qdd2*cos(5239260779425957/18014398509481984))/100000 - (129*qdd2*sin(5239260779425957/18014398509481984))/10000 - (3*qdd3*sin(5239260779425957/18014398509481984))/20 - (49*q3*sin(q1 - q2))/10 - (3*q3*qdd2*cos(5239260779425957/18014398509481984))/10 - (3*qd2*qd3*cos(5239260779425957/18014398509481984))/5 + q3^2*qd1^2*sin(2*q2) + 4*q3*qd2*qd3 - (3*q3*qd1^2*sin(2*q2 - 5239260779425957/18014398509481984))/10 - (43*q3*qd1^2*cos(2*q2))/500 + (1281*q3*qd1^2*sin(2*q2))/5000,                                                                                                                                    (49*q3*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 + q3^2*qdd2 - (49*q3*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + q3^2*qd1^2*sin(2*q2 - 5239260779425957/9007199254740992) + 4*q3*qd2*qd3,                                                                                                                                                                       (1281*qdd2)/5000 - (49*sin(q1 - q2))/10 + (49*sin(q1 + q2))/10 + 2*q3*qdd2 + 4*qd2*qd3 - (3*qd1^2*sin(2*q2 - 5239260779425957/18014398509481984))/10 - (43*qd1^2*cos(2*q2))/500 + (1281*qd1^2*sin(2*q2))/5000 - (3*qdd2*cos(5239260779425957/18014398509481984))/10 + 2*q3*qd1^2*sin(2*q2),               0,                                                                                                                   2*q3*sin(2*q2 - 5239260779425957/9007199254740992)*qd1^2 - (49*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + (49*sin(q1 - q2 + 5239260779425957/18014398509481984))/10 + 2*q3*qdd2 + 4*qd2*qd3, -q2,   0,    0, -qd2,    0,          0, -sign(qd2),          0, qdd2,                                                       -qdd1*cos(q2 - 5239260779425957/18014398509481984),                                                                      -qd1^2*sin(2*q2 - 5239260779425957/9007199254740992),                                  -qd1^2*sin(2*q2),                                                              (3*sin(2*q2 - 5239260779425957/9007199254740992)*qd1^2)/10 + (3*qdd2)/10 - (49*sin(q1 + q2 - 5239260779425957/18014398509481984))/10 + (49*sin(q1 - q2 + 5239260779425957/18014398509481984))/10,    0, -qdd1,                                                                                                (2881*qdd2)/5000 + (49*sin(q1 - q2))/10 - (49*sin(q1 + q2))/10 + (3*qd1^2*sin(2*q2 - 5239260779425957/18014398509481984))/10 + (2881*qd1^2*sin(2*q2))/5000 + (3*qdd2*cos(5239260779425957/18014398509481984))/10,                   qdd1*sin(q2)];
F((k-1)*four.dof+3,:)=[                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           (43*qdd2)/1000 + qdd3 - (49*cos(q1 - q2))/10 - (49*cos(q1 + q2))/10 + (3*qd1^2*cos(5239260779425957/18014398509481984))/20 + (3*qd2^2*cos(5239260779425957/18014398509481984))/10 + (3*qd1^2*cos(2*q2 - 5239260779425957/18014398509481984))/20 - (1281*qd1^2*cos(2*q2))/10000 - (43*qd1^2*sin(2*q2))/1000 - q3*qd1^2 - 2*q3*qd2^2 - (3*qdd2*sin(5239260779425957/18014398509481984))/20 - (1281*qd1^2)/10000 - (1281*qd2^2)/5000 - q3*qd1^2*cos(2*q2),                                                                                                                                        qdd3 + (49*cos(q1 + q2 - 5239260779425957/18014398509481984))/10 + (49*cos(q1 - q2 + 5239260779425957/18014398509481984))/10 - q3*qd1^2 - 2*q3*qd2^2 - q3*qd1^2*cos(2*q2 - 5239260779425957/9007199254740992),                                                                                                                                                                                                                                                                                                                                                                                                                              - qd1^2*cos(2*q2) - qd1^2 - 2*qd2^2,               0,                                                                                                                                                                                                                                                    - qd1^2*cos(2*q2 - 5239260779425957/9007199254740992) - qd1^2 - 2*qd2^2,   0,   0, -qd3,    0,    0, -sign(qd3),          0,          0,    0,                                                                                                        0,                                                                                                                         0,                                                 0,                                                                                                                                                                                                                                                             0,    0,     0,                                                                                                                                                                                                                                                                                                               0,                              0];

F((k-1)*four.dof+1:(k-1)*four.dof+four.dof,:) = F((k-1)*four.dof+1:(k-1)*four.dof+four.dof,:).*four.scale.';

%F((k-1)*four.dof+1:(k-1)*four.dof+four.dof,:) = F((k-1)*four.dof+1:(k-1)*four.dof+four.dof,:).*(four.scale_noise.');
end

P = diag(1./vecnorm(F));

%toc
% Normal Condition
val = cond(F*P);

%val = cond(F);


%First Condition
%val = cond(mpower(four.cov,-0.5)*F);

%Second Condition
%val = -log(det(F.'*mpower(four.cov,-1)*F));
end